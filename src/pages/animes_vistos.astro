---
import Layout from "../layouts/Layout.astro";
import ArrowLSvg from "../SVGs/Arrow_L_svg.astro";
import ArrowRSvg from "../SVGs/Arrow_R_svg.astro";
import TrashsSvg from "../SVGs/Trash_svg.astro";


---

<Layout title="Animes Vistos" bg_color=" bg-neutral-900">
    <main id="top" class="font-mono text-zinc-300 p-6">
        <a
            href="#top"
            class="fixed text-white flex items-center justify-center font-bold bottom-0 right-0 mb-2 mr-2 w-11 h-11 z-10 bg-zinc-800 rounded-full hover:bg-orange-800"
        >
            ↑
        </a>
        <a
            href="https://tiermaker.com/create/animes-random-saikomic-16203118"
            target="_blank"
            class="absolute hidden md:block text-white top-7 right-16 transition-all hover:text-gray-500"
        >
            Tiermaker
        </a>
        <h1 id="title" class="text-center text-white text-4xl mb-6">
            Animes Vistos
        </h1>
        <div
            id="search-container"
            class="flex items-center justify-center mb-6 gap-1"
        >
            <input
                type="text"
                id="search-input"
                class="p-2 w-80 max-w-xs border-zinc-400 border-2 rounded-l-md bg-transparent text-zinc-300"
                placeholder="Buscar por nombre..."
            />

            <button
                id="clear-button"
                class="border-2 border-zinc-400 hover:text-white text-zinc-300 rounded-r-md p-2 hover:bg-orange-800 transition-all"
            >
                <TrashsSvg />
            </button>
        </div>

        <div
            id="pagination"
            class="flex justify-center items-center space-x-4 mt-6 mb-6 text-sm"
        >
            <button
                id="prev-page"
                class="bg-zinc-800 text-white rounded-md py-2.5 pr-4 pl-3 hover:bg-orange-800 transition-all flex items-center gap-1 disabled:opacity-50 disabled:hover:bg-zinc-800"
                disabled
            >
                <ArrowLSvg /> Anterior
            </button>
            <button
                id="next-page"
                class="bg-zinc-800 text-white rounded-md py-2.5 pr-3 pl-4 hover:bg-orange-800 transition-all flex items-center gap-1 disabled:opacity-50 disabled:hover:bg-zinc-800"
            >
                Siguiente <ArrowRSvg />
            </button>
        </div>

        <div
            id="animes"
            class="flex flex-wrap gap-y-4 justify-center transition-opacity duration-300"
        >
        </div>

        <div
            id="pagination"
            class="flex justify-center items-center space-x-4 mt-6"
        >
            <button
                id="prev-page2"
                class="bg-zinc-800 text-white rounded-md py-2.5 pr-4 pl-3 hover:bg-orange-800 transition-all flex items-center gap-1 disabled:opacity-50 disabled:hover:bg-zinc-800"
                disabled
            >
                <ArrowLSvg /> Anterior
            </button>
            <button
                id="next-page2"
                class="bg-zinc-800 text-white rounded-md py-2.5 pr-3 pl-4 hover:bg-orange-800 transition-all flex items-center gap-1 disabled:opacity-50 disabled:hover:bg-zinc-800"
            >
                Siguiente <ArrowRSvg />
            </button>
        </div>
        <footer
            class="text-zinc-600 text-center text-sm mt-6 mb-1 tracking-tight"
        >
            Esta lista comprende todos los animes randoms vistos en el canal del
            Saiko y uno que otro anime que el Saiko se vio una vez por su cuenta
            (puede faltar alguno) <br />
            Postdata: VIVAN LAS LESBIANAS!!!!
        </footer>
        <link rel="preconnect" href="https://tiermaker.com" />
        <link rel="preconnect" href="https://m.media-amazon.com" />
    </main>
</Layout>

<style>
    html {
        scroll-behavior: smooth;
    }

    /* BARRA DE DESPLAZAMIENTO */
    /* Estilos para la barra de desplazamiento en WebKit (Safari, Chrome, Opera) */
    html::-webkit-scrollbar {
        /*Ancho de la barra de desplazamiento*/
        width: 10px;
    }

    html::-webkit-scrollbar-track {
        /*Color del fondo de la barra de desplazamiento*/
        background: #464545;
    }

    html::-webkit-scrollbar-thumb {
        /* Color de la barra por default */
        background: linear-gradient(
            45deg,
            #ff8c00,
            #ffa500,
            #ffb347,
            #ffcc33,
            #ff7043,
            #ff5722
        );
        /* Radio de los bordes de la barra de desplazamiento */
        border-radius: 5px;
    }

    html::-webkit-scrollbar-thumb:hover {
        /* Cambio de color al pasar el mouse sobre la barra de desplazamiento */
        background: #a5a3a3;
        /* // background: linear-gradient(45deg, #5b33b9, #704bb6, #89379e, #b635a0, #b42655, #da2727); */
    }
</style>

<script>
    // Se importa el archivo de datos de los animes
    import data from "../assets/anime_list.json";

    // Se agregan eventos de DOMContentLoaded para que se ejecute el código cuando se cargue la página
    document.addEventListener("DOMContentLoaded", () => {
        const searchInput = document.getElementById(
            "search-input",
        ) as HTMLInputElement;
        const clearButton = document.getElementById("clear-button");
        const animesDiv = document.getElementById("animes");
        const prevPageButton = document.getElementById(
            "prev-page",
        ) as HTMLButtonElement;
        const nextPageButton = document.getElementById(
            "next-page",
        ) as HTMLButtonElement;
        const prevPageButton2 = document.getElementById(
            "prev-page2",
        ) as HTMLButtonElement;
        const nextPageButton2 = document.getElementById(
            "next-page2",
        ) as HTMLButtonElement;

        let filteredData = data;
        let currentPage = 0;
        const pageSize = 50;

        function loadAnimes() {
            const start = currentPage * pageSize;
            const end = start + pageSize;
            return filteredData.slice(start, end);
        }

        function displayAnimes() {
            animesDiv.classList.add("opacity-0"); // Inicia con opacidad 0
            setTimeout(() => {
                animesDiv.innerHTML = ""; // Limpiar el contenido existente
                loadAnimes().forEach((anime) => {
                    const notaColor =
                        typeof anime.nota === "string" &&
                        anime.nota.includes("goty")
                            ? "text-white bg-gradient-to-r from-yellow-600 to-orange-600 px-2 py-1 transition-all"
                            : (typeof anime.nota === "string" &&
                                    (anime.nota.includes("god") ||
                                        anime.nota.includes("wena"))) ||
                                anime.nota === "piola"
                              ? "text-white bg-green-800 px-2 py-1 transition-all"
                              : typeof anime.nota === "string" &&
                                  (anime.nota.includes("no me gusto") ||
                                      anime.nota.includes("mala"))
                                ? "text-white bg-red-800 px-2 py-1 transition-all"
                                : "bg-gray-700/90 text-white-200 px-2 py-1"; // Otras notas

                    animesDiv.innerHTML += `
    <div class="rounded-lg shadow-lg p-0 md:m-2 m-0.5 md:max-w-xs flex flex-col items-center text-center transition-all duration-300 hover:-translate-y-1 relative group w-[110px] h-[180px] md:w-[210px] md:h-[310px]">
        <img rel="preload" loading="lazy" src="${anime.url}" alt="${anime.nombre}" width="120" height="200" class="w-full h-full object-cover rounded-lg"/>

        <div class="absolute inset-x-0 bottom-0 bg-black/80 flex flex-col items-center p-2">
            <h2 class="text-white text-sm md:text-lg mb-1 truncate w-24 md:w-full">
                ${anime.nombre.length > 14 ? anime.nombre.substring(0, 14) + "..." : anime.nombre}
            </h2>
            <p class="text-zinc-300 hidden md:block text-sm">ID: ${anime.id}</p>
        </div>

        <p class="${notaColor} rounded-xl z-20 md:z-0 font-sans text-xs md:text-sm mt-2 tracking-widest uppercase font-bold absolute px-2 left-1 -top-1 select-none">
            ${anime.nota ? anime.nota : ". . ."}
        </p>
    </div>`;
                });
                animesDiv.classList.remove("opacity-0"); // Cambia a opacidad 1
            }, 200); // Tiempo de retraso para la animación
        }

        searchInput.addEventListener("input", () => {
            // Obtener el valor de la búsqueda, eliminar espacios en blanco y convertir a minúsculas
            let query = searchInput.value.trim().toLowerCase();

            // Reemplazar espacios en blanco con guiones
            query = query.replace(/\s+/g, "-");

            // Filtrar los datos en función del nombre del anime
            filteredData = data.filter((anime) =>
                anime.nombre.toLowerCase().includes(query),
            );

            currentPage = 0; // Resetear a la primera página
            displayAnimes();
            updatePaginationButtons();
        });

        clearButton.addEventListener("click", () => {
            searchInput.value = "";
            searchInput.dispatchEvent(new Event("input")); // Desencadenar evento de búsqueda
        });

        nextPageButton.addEventListener("click", () => {
            if (currentPage * pageSize < filteredData.length) {
                currentPage++;
                displayAnimes();
                updatePaginationButtons();
            }
        });

        prevPageButton.addEventListener("click", () => {
            if (currentPage > 0) {
                currentPage--;
                displayAnimes();
                updatePaginationButtons();
            }
        });

        nextPageButton2.addEventListener("click", () => {
            if (currentPage * pageSize < filteredData.length) {
                currentPage++;
                displayAnimes();
                updatePaginationButtons();
            }
        });

        prevPageButton2.addEventListener("click", () => {
            if (currentPage > 0) {
                currentPage--;
                displayAnimes();
                updatePaginationButtons();
            }
        });

        function updatePaginationButtons() {
            prevPageButton.disabled = currentPage === 0;
            prevPageButton2.disabled = currentPage === 0;
            nextPageButton.disabled =
                (currentPage + 1) * pageSize >= filteredData.length;
            nextPageButton2.disabled =
                (currentPage + 1) * pageSize >= filteredData.length;
        }

        displayAnimes(); // Mostrar animes al cargar la página
    });
</script>
